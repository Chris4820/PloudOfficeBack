{"version":3,"file":"upload-image.js","sourceRoot":"/","sources":["utils/images/upload-image.ts"],"names":[],"mappings":";;AAYA,0EAUC;AAED,oEAUC;AAED,gFAUC;AAGD,4DAGC;AAED,gEAGC;AAED,4EAGC;AA7DD,8CAAsD;AACtD,mDAA+E;AAUxE,KAAK,UAAU,+BAA+B,CAAC,OAAe,EAAE,SAAiB,EAAE,KAAiB;IACzG,IAAI,CAAC,KAAK;QAAE,OAAO,IAAI,CAAC;IAExB,IAAI,KAAK,CAAC,IAAI,GAAG,8BAAc,EAAE,CAAC;QAChC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,CAAC,mCAAmB,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC;QAC9C,OAAO,IAAI,CAAC;IACd,CAAC;IACD,OAAO,GAAG,uBAAO,IAAI,OAAO,YAAY,SAAS,EAAE,CAAC;AACtD,CAAC;AAEM,KAAK,UAAU,4BAA4B,CAAC,OAAe,EAAE,KAAiB;IACnF,IAAI,CAAC,KAAK;QAAE,OAAO,IAAI,CAAC;IAExB,IAAI,KAAK,CAAC,IAAI,GAAG,8BAAc,EAAE,CAAC;QAChC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,CAAC,mCAAmB,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC;QAC9C,OAAO,IAAI,CAAC;IACd,CAAC;IACD,OAAO,GAAG,uBAAO,IAAI,OAAO,cAAc,CAAC;AAC7C,CAAC;AAEM,KAAK,UAAU,kCAAkC,CAAC,OAAe,EAAE,KAAiB;IACzF,IAAI,CAAC,KAAK;QAAE,OAAO,IAAI,CAAC;IAExB,IAAI,KAAK,CAAC,IAAI,GAAG,8BAAc,EAAE,CAAC;QAChC,OAAO,IAAI,CAAC;IACd,CAAC;IACD,IAAI,CAAC,mCAAmB,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC;QAC9C,OAAO,IAAI,CAAC;IACd,CAAC;IACD,OAAO,GAAG,uBAAO,IAAI,OAAO,oBAAoB,CAAC;AACnD,CAAC;AAGM,KAAK,UAAU,wBAAwB,CAAC,OAAe,EAAE,SAAiB,EAAE,SAAiB;IAClG,MAAM,GAAG,GAAG,GAAG,OAAO,YAAY,SAAS,EAAE,CAAC;IAC9C,OAAO,MAAM,IAAA,0BAAiB,EAAC,GAAG,EAAE,SAAS,CAAC,CAAC;AACjD,CAAC;AAEM,KAAK,UAAU,0BAA0B,CAAC,OAAe,EAAE,SAAiB;IACjF,MAAM,GAAG,GAAG,GAAG,OAAO,cAAc,CAAC;IACrC,OAAO,MAAM,IAAA,0BAAiB,EAAC,GAAG,EAAE,SAAS,CAAC,CAAC;AACjD,CAAC;AAEM,KAAK,UAAU,gCAAgC,CAAC,OAAe,EAAE,SAAiB;IACvF,MAAM,GAAG,GAAG,GAAG,OAAO,oBAAoB,CAAC;IAC3C,OAAO,MAAM,IAAA,0BAAiB,EAAC,GAAG,EAAE,SAAS,CAAC,CAAC;AACjD,CAAC","sourcesContent":["import { BadRequestException } from \"../../commons/errors/custom.error\";\r\nimport { getSignedUrlImage } from \"../../libs/r2.lib\";\r\nimport { ALLOWED_IMAGE_TYPES, CDN_URL, MAX_SIZE_IMAGE } from \"./image.contant\";\r\n\r\n\r\n\r\n\r\ntype ImageProps = {\r\n  size?: number,\r\n  type?: string,\r\n}\r\n\r\nexport async function CheckAndGenerateServiceImageUrl(storeId: number, serviceId: number, image: ImageProps): Promise<string | null> {\r\n  if (!image) return null;\r\n\r\n  if (image.size > MAX_SIZE_IMAGE) {\r\n    return null;\r\n  }\r\n  if (!ALLOWED_IMAGE_TYPES.includes(image.type)) {\r\n    return null;\r\n  }\r\n  return `${CDN_URL}/${storeId}/service/${serviceId}`;\r\n}\r\n\r\nexport async function CheckAndGenerateLogoImageUrl(storeId: number, image: ImageProps): Promise<string | null> {\r\n  if (!image) return null;\r\n\r\n  if (image.size > MAX_SIZE_IMAGE) {\r\n    return null;\r\n  }\r\n  if (!ALLOWED_IMAGE_TYPES.includes(image.type)) {\r\n    return null;\r\n  }\r\n  return `${CDN_URL}/${storeId}/design/logo`;\r\n}\r\n\r\nexport async function CheckAndGenerateBackgroundImageUrl(storeId: number, image: ImageProps): Promise<string | null> {\r\n  if (!image) return null;\r\n\r\n  if (image.size > MAX_SIZE_IMAGE) {\r\n    return null;\r\n  }\r\n  if (!ALLOWED_IMAGE_TYPES.includes(image.type)) {\r\n    return null;\r\n  }\r\n  return `${CDN_URL}/${storeId}/design/background`;\r\n}\r\n\r\n\r\nexport async function generateServiceSignedUrl(storeId: number, serviceId: number, imageType: string) {\r\n  const key = `${storeId}/service/${serviceId}`;\r\n  return await getSignedUrlImage(key, imageType);\r\n}\r\n\r\nexport async function generateStoreLogoSignedUrl(storeId: number, imageType: string) {\r\n  const key = `${storeId}/design/logo`;\r\n  return await getSignedUrlImage(key, imageType);\r\n}\r\n\r\nexport async function generateStoreBackgroundSignedUrl(storeId: number, imageType: string) {\r\n  const key = `${storeId}/design/background`;\r\n  return await getSignedUrlImage(key, imageType);\r\n}"]}