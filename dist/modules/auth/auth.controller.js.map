{"version":3,"file":"auth.controller.js","sourceRoot":"/","sources":["modules/auth/auth.controller.ts"],"names":[],"mappings":";;AAcA,0CAsBC;AAED,gDAoBC;AAzDD,iDAAgD;AAChD,+CAAmE;AACnE,yDAA6D;AAG7D,uDAAgE;AAChE,oEAAsE;AAEtE,6CAAsD;AAK/C,KAAK,UAAU,eAAe,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;IACnF,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,GAAG,CAAC,IAAwB,CAAC;QAE1C,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAClB,MAAM,IAAI,GAAG,MAAM,IAAA,6BAAc,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC9C,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,MAAM,IAAA,wBAAe,EAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC;YACpE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,uBAAuB,EAAE,CAAC,CAAA;QACnE,CAAC;QAED,UAAU;QACV,MAAM,KAAK,GAAG,MAAM,IAAA,0BAAe,EAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC;QAC1E,MAAM,EAAE,QAAQ,EAAE,GAAG,mBAAmB,EAAE,GAAG,IAAI,CAAC;QAClD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;YAC1B,IAAI,EAAE,mBAAmB;YACzB,OAAO,EAAE;gBACP,KAAK;aACN;SACF,CAAC,CAAA;IACJ,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,IAAI,CAAC,KAAK,CAAC,CAAC;IACd,CAAC;AACH,CAAC;AAEM,KAAK,UAAU,kBAAkB,CAAC,GAAY,EAAE,GAAa,EAAE,IAAkB;IACtF,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,GAAG,CAAC,IAA2B,CAAC;QAC7C,yCAAyC;QACzC,MAAM,IAAI,GAAG,MAAM,IAAA,2BAAY,EAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5C,IAAI,IAAI,EAAE,CAAC;YACT,MAAM,IAAI,gCAAiB,CAAC,8BAA8B,CAAC,CAAC;QAC9D,CAAC;QACD,MAAM,eAAe,GAAoB;YACvC,IAAI,EAAE,IAAI,CAAC,IAAI;YACf,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,QAAQ,EAAE,MAAM,IAAA,qBAAY,EAAC,IAAI,CAAC,QAAQ,CAAC;YAC3C,SAAS,EAAE,MAAM,IAAA,yBAAiB,EAAC,IAAI,CAAC,IAAI,CAAC;SAC9C,CAAA;QAED,MAAM,IAAA,yBAAU,EAAC,eAAe,CAAC,CAAA;QACjC,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,wBAAwB,EAAE,CAAC,CAAC;IACrE,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,IAAI,CAAC,KAAK,CAAC,CAAC;IACd,CAAC;AACH,CAAC","sourcesContent":["import { Request, Response, type NextFunction } from \"express\";\r\nimport { getUserByEmail } from \"./auth.service\";\r\nimport { comparePassword, hashPassword } from \"../../utils/bcrypt\";\r\nimport { generateAuthJWT } from \"../../commons/jwt/auth.jwt\";\r\nimport type { LoginSchemaProps } from \"./schema/login.schema\";\r\nimport type { RegisterSchemaProps } from \"./schema/register.schema\";\r\nimport { createUser, isEmailExist } from \"../user/user.service\";\r\nimport { ConflictException } from \"../../commons/errors/custom.error\";\r\nimport type { CreateUserProps } from \"../user/types/user.type\";\r\nimport { generateShortName } from \"../../utils/utils\";\r\n\r\n\r\n\r\n\r\nexport async function LoginController(req: Request, res: Response, next: NextFunction) {\r\n  try {\r\n    const data = req.body as LoginSchemaProps;\r\n\r\n    console.log(data);\r\n    const user = await getUserByEmail(data.email);\r\n    if (!user || !(await comparePassword(data.password, user.password))) {\r\n      return res.status(400).json({ message: 'Credenciais inválidas' })\r\n    }\r\n\r\n    //Validado\r\n    const token = await generateAuthJWT(user.id, data.remember ? '7d' : '2h');\r\n    const { password, ...userWithoutPassword } = user;\r\n    return res.status(200).json({\r\n      user: userWithoutPassword,\r\n      session: {\r\n        token,\r\n      }\r\n    })\r\n  } catch (error) {\r\n    next(error);\r\n  }\r\n}\r\n\r\nexport async function RegisterController(req: Request, res: Response, next: NextFunction) {\r\n  try {\r\n    const data = req.body as RegisterSchemaProps;\r\n    //Verificar se o email já está registrado\r\n    const user = await isEmailExist(data.email);\r\n    if (user) {\r\n      throw new ConflictException(\"Esse email já está registado\");\r\n    }\r\n    const currentUserData: CreateUserProps = {\r\n      name: data.name,\r\n      email: data.email,\r\n      password: await hashPassword(data.password),\r\n      shortName: await generateShortName(data.name),\r\n    }\r\n\r\n    await createUser(currentUserData)\r\n    return res.status(200).json({ message: 'Registado com sucesso!' });\r\n  } catch (error) {\r\n    next(error);\r\n  }\r\n}"]}